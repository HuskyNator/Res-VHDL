$schema: https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json
name: Adrian Syntax Notation
scopeName: source.asn
patterns:
    - include: "#group_round"
    - include: "#group_square"
    - include: "#set"
    - include: "#placeholder"
    # - include: "#text"
repository:
    text:
        name: string.unquoted
        match: &text ([^@\s\[\]\(\)\\]|\\\[|\\\]|\\\(|\\\)|\\\@|\\\\)+

    # List key
    listkey_single:
        name: meta.cast.listkey.single
        match: '\^.(#count)?'
    listkey_multi:
        name: meta.cast.listkey.multi
        match: '\^\(*text\)(#count)?'
    # Count
    count_single:
        name: meta.cast.count.single
        match: '[\?|\+|\*]'
    count_multi:
        name: meta.cast.count.multi
        match: '[0-9]*\-[0-9]*\*'
    
    # Placeholder
    placeholder:
        name: entity.name.class
        # match: '@(#listkey_single|#listkey_multi)?(#count_single|#count_multi)?(\w)+'
        match: '@([\?|\+|\*]|[0-9]*\-[0-9]*\*)?([a-zA-Z_]\w*)'
    
    # Set
    set:
        name: meta.set
        begin: '@(#listkey_single|#listkey_multi)?(#count_single|#count_multi)?\['
        end: \]
        beginCaptures:
            "0":
                name: bracket.open
        endCaptures:
            "0":
                name: bracket.close
        patterns:
            - include: "#or"
    or:
        name: keyword.operator
        begin: '#element\|'
        end: "#element"
        patterns:
            - include: "#or"
    
    # Group
    group_round:
        name: meta.group.bracket.round
        begin: '@(#listkey_single|#listkey_multi)?(#count_single|#count_multi)?\('
        end: \)
        beginCaptures:
            "0":
                name: bracket.open
        endCaptures:
            "0":
                name: bracket.close
        patterns:
            - include: $self
    group_square:    
        name: meta.group.bracket.square
        begin: '@(#listkey_single|#listkey_multi)?(#count_single|#count_multi)?\['
        end: \]
        beginCaptures:
            "0":
                name: bracket.open
        endCaptures:
            "0":
                name: bracket.close
        patterns:
            - include: $self
