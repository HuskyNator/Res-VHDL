$schema: https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json
name: Adrian Syntax Notation
scopeName: source.asn
patterns:
    - include: "#invalid_escape"
    # - include: "#invalid_list"
    - include: "#group_round"
    - include: "#group_square"
    - include: "#placeholder"
    - include: "#text"
repository:
    text:
        name: string.unquoted
        match: &text ([^@\s\[\]\(\)\\]|\\\[|\\\]|\\\(|\\\)|\\\@|\\\\)+

    # List key
    listkey_single:
        name: meta.cast.listkey.single
        match: '\^.(#count)?'
    listkey_multi:
        name: meta.cast.listkey.multi
        match: '\^\(*text\)(#count)?'
    # # Count
    # count_single:
    #     name: meta.cast.count.single
    #     match: '[\?|\+|\*]'
    # count_multi:
    #     name: meta.cast.count.multi
    #     match: '[0-9]*\-[0-9]*\*'
    
    # Placeholder
    placeholder:
        name: entity.name.class
        match: '(@)([\?|\+|\*]|[0-9]*\-[0-9]*\*)?([a-zA-Z_]\w*)'
        captures:
            "1": keyword.operator.element
    
    # Group (& Set)

        # (@)                           #1 Element Operator
        # (                             #2 List
            # (\^)                          #3 Operator
            # (                             #4 Delimiter
                # (.)                           #5 Single
            # |
                # \((                           #6 Multiple
                    # (                             #7 Character
                        # [^@\s\[\]\(\)\\]
                    # |
                        # \\\[
                    # |
                        # \\\]
                    # |
                        # \\\(
                    # |
                        # \\\)
                    # |
                        # \\\@
                    # |
                        # \\\\
                    # )+                            #7 Character
                # )\)                          #6 Multiple
            # )                             #4 Delimiter
        # )?                            #2 List
        # (                             #8 Count
            # [\?|\+|\*]
        # |
            # [0-9]*\-[0-9]*\*
        # )?                            #8 Count
        # \(

    group_round:
        name: meta.group.bracket.round
        begin: '(@)((\^)((.)|\((([^@\s\[\]\(\)\\]|\\\[|\\\]|\\\(|\\\)|\\\@|\\\\)+)\)))?([\?|\+|\*]|[0-9]*\-[0-9]*\*)?\('
        end: \)
        beginCaptures:
            "0":
                name: bracket.open.round
            "1":
                name: keyword.operator.element
            "2":
                name: meta.list
            "3":
                name: keyword.operator.list
            "4":
                name: keyword.operator.delimiter
            "5":
                name: string.other
            "6":
                name: string.other
            # "7":
            #     name: string.other
            "8":
                name: keyword.operator.count
        endCaptures:
            "0":
                name: bracket.close
        patterns:
            - name: keyword.operator.or
              match: '\|' # match 'or' for set
            - include: $self
    group_square:    
        name: meta.group.bracket.square
        begin: '(@)((\^)((.)|\((([^@\s\[\]\(\)\\]|\\\[|\\\]|\\\(|\\\)|\\\@|\\\\)+)\)))?([\?|\+|\*]|[0-9]*\-[0-9]*\*)?\['
        end: \]
        beginCaptures:
            "0":
                name: bracket.open.round
            "1":
                name: keyword.operator.element
            "2":
                name: meta.list
            "3":
                name: keyword.operator.list
            "4":
                name: keyword.operator.delimiter
            "5":
                name: string.other
            "6":
                name: string.other
            # "7":
            #     name: string.other
            "8":
                name: keyword.operator.count
        endCaptures:
            "0":
                name: bracket.open
        patterns:
            - name: keyword.operator.or
              match: '\|' # match 'or' for set
            - include: $self

    invalid_escape:
        name: invalid.illegal
        match: '(?<!\\)\\(?=[^\[\]\(\)@\\])'

    # invalid_list:
        # name: invalid.illegal
